/*C2*/SET SCHEMA PUBLIC
DISCONNECT
/*C3*/SET SCHEMA PUBLIC
DISCONNECT
/*C4*/SET SCHEMA PUBLIC
DISCONNECT
/*C5*/SET SCHEMA PUBLIC
DISCONNECT
/*C6*/SET SCHEMA PUBLIC
DISCONNECT
/*C7*/SET SCHEMA PUBLIC
DISCONNECT
/*C9*/SET SCHEMA PUBLIC
DISCONNECT
/*C8*/SET SCHEMA PUBLIC
DISCONNECT
/*C10*/SET SCHEMA PUBLIC
DISCONNECT
/*C11*/SET SCHEMA PUBLIC
DISCONNECT
/*C13*/SET SCHEMA PUBLIC
DISCONNECT
/*C12*/SET SCHEMA PUBLIC
DISCONNECT
/*C14*/SET SCHEMA PUBLIC
alter table SYS_ENTITY_SNAPSHOT add STRING_ENTITY_ID varchar(255)
\u000aalter table SYS_ENTITY_SNAPSHOT add INT_ENTITY_ID integer
\u000aalter table SYS_ENTITY_SNAPSHOT add LONG_ENTITY_ID bigint
INSERT INTO SYS_DB_CHANGELOG VALUES('10-cuba/update/hsql/17/170214-addEntityIdToSnapshot.sql','2017-07-24 19:06:56.671000',0)
COMMIT
alter table SEC_ENTITY_LOG add STRING_ENTITY_ID varchar(255)
\u000aalter table SEC_ENTITY_LOG add INT_ENTITY_ID integer
\u000aalter table SEC_ENTITY_LOG add LONG_ENTITY_ID bigint
INSERT INTO SYS_DB_CHANGELOG VALUES('10-cuba/update/hsql/17/170215-addEntityIdToEntityLog.sql','2017-07-24 19:06:56.679000',0)
COMMIT
alter table SYS_CATEGORY_ATTR add DEFAULT_STR_ENTITY_VALUE varchar(255)
\u000aalter table SYS_CATEGORY_ATTR add DEFAULT_INT_ENTITY_VALUE integer
\u000aalter table SYS_CATEGORY_ATTR add DEFAULT_LONG_ENTITY_VALUE bigint
\u000aalter table SYS_ATTR_VALUE add STRING_ENTITY_ID varchar(255)
\u000aalter table SYS_ATTR_VALUE add INT_ENTITY_ID integer
\u000aalter table SYS_ATTR_VALUE add LONG_ENTITY_ID bigint
\u000aalter table SYS_ATTR_VALUE add STRING_ENTITY_VALUE varchar(255)
\u000aalter table SYS_ATTR_VALUE add INT_ENTITY_VALUE integer
\u000aalter table SYS_ATTR_VALUE add LONG_ENTITY_VALUE bigint
INSERT INTO SYS_DB_CHANGELOG VALUES('10-cuba/update/hsql/17/170221-addEntityIdToAttributeValue.sql','2017-07-24 19:06:56.687000',0)
COMMIT
create table SEC_SESSION_LOG (\u000a    ID varchar(36) not null,\u000a    VERSION integer not null,\u000a    CREATE_TS timestamp,\u000a    CREATED_BY varchar(50),\u000a    UPDATE_TS timestamp,\u000a    UPDATED_BY varchar(50),\u000a    DELETE_TS timestamp,\u000a    DELETED_BY varchar(50),\u000a    --\u000a    SESSION_ID varchar(36) not null,\u000a    SUBSTITUTED_USER_ID varchar(36),\u000a    USER_ID varchar(36) not null,\u000a    USER_DATA longvarchar,\u000a    LAST_ACTION integer not null,\u000a    CLIENT_INFO varchar(512),\u000a    ADDRESS varchar(255),\u000a    STARTED_TS timestamp,\u000a    FINISHED_TS timestamp,\u000a    CLIENT_TYPE varchar(10),\u000a    SERVER_ID varchar(128),\u000a    --\u000a    primary key (ID)\u000a)
\u000aalter table SEC_SESSION_LOG add constraint FK_SEC_SESSION_LOG_USER foreign key (USER_ID) references SEC_USER(ID)
\u000acreate index IDX_SEC_SESSION_LOG_USER on SEC_SESSION_LOG (USER_ID)
\u000aalter table SEC_SESSION_LOG add constraint FK_SEC_SESSION_LOG_SUBUSER foreign key (SUBSTITUTED_USER_ID) references SEC_USER(ID)
\u000acreate index IDX_SEC_SESSION_LOG_SUBUSER on SEC_SESSION_LOG (SUBSTITUTED_USER_ID)
INSERT INTO SYS_DB_CHANGELOG VALUES('10-cuba/update/hsql/17/170502-createSessionHistoryTable.sql','2017-07-24 19:06:56.693000',0)
COMMIT
-- Increase length of SEC_CONSTRAINT columns\u000aalter table SEC_CONSTRAINT alter column GROOVY_SCRIPT longvarchar
\u000aalter table SEC_CONSTRAINT alter column FILTER_XML longvarchar
INSERT INTO SYS_DB_CHANGELOG VALUES('10-cuba/update/hsql/17/170620-alterConstraints.sql','2017-07-24 19:06:56.695000',0)
COMMIT
create table SEC_LOCALIZED_CONSTRAINT_MSG (\u000a    ID varchar(36) not null,\u000a    CREATE_TS timestamp,\u000a    CREATED_BY varchar(50),\u000a    VERSION integer,\u000a    UPDATE_TS timestamp,\u000a    UPDATED_BY varchar(50),\u000a    DELETE_TS timestamp,\u000a    DELETED_BY varchar(50),\u000a    --\u000a    ENTITY_NAME varchar(255) not null,\u000a    OPERATION_TYPE varchar(50) not null,\u000a    VALUES_ longvarchar,\u000a    --\u000a    primary key (ID)\u000a)
\u000acreate unique index IDX_SEC_LOC_CNSTRNT_MSG_UNIQUE\u000a  on SEC_LOCALIZED_CONSTRAINT_MSG (ENTITY_NAME, OPERATION_TYPE, DELETE_TS)
INSERT INTO SYS_DB_CHANGELOG VALUES('10-cuba/update/hsql/17/170712-createLocalizedConstraintMessageTable.sql','2017-07-24 19:06:56.697000',0)
COMMIT
create table SYS_REST_API_TOKEN (\u000a    ID varchar(36) not null,\u000a    CREATE_TS timestamp,\u000a    CREATED_BY varchar(50),\u000a    --\u000a    ACCESS_TOKEN_VALUE varchar(255),\u000a    ACCESS_TOKEN_BYTES longvarbinary,\u000a    AUTHENTICATION_KEY varchar(255),\u000a    AUTHENTICATION_BYTES longvarbinary,\u000a    EXPIRY timestamp,\u000a    --\u000a    primary key (ID)\u000a)
INSERT INTO SYS_DB_CHANGELOG VALUES('10-cuba/update/hsql/17/280217-createRestApiTokenTable.sql','2017-07-24 19:06:56.699000',0)
COMMIT
alter table REPORT_REPORT add ROLES_IDX VARCHAR(1000)
\u000aalter table REPORT_REPORT add SCREENS_IDX VARCHAR(1000)
\u000aalter table REPORT_REPORT add INPUT_ENTITY_TYPES_IDX VARCHAR(1000)
INSERT INTO SYS_DB_CHANGELOG VALUES('20-reports/update/hsql/17/170131-addFieldsForAvailableReports.sql','2017-07-24 19:06:56.704000',0)
COMMIT
/*C15*/SET SCHEMA PUBLIC
DISCONNECT
/*C16*/SET SCHEMA PUBLIC
DELETE FROM REPORT_REPORT WHERE ID='11227ff1-eb7b-034d-b3f6-c1830cab6c08'
INSERT INTO REPORT_REPORT VALUES('11227ff1-eb7b-034d-b3f6-c1830cab6c08','2017-02-09 20:14:38.325000','admin',42,'2017-03-13 16:38:12.970000','admin','[CHART] Income from customer by date',NULL,NULL,NULL,'4e083530-0b9c-11e1-9b41-6bdaa41bff94',10,'5ee03091-1b10-392e-86c1-2ce6d2a4f610','{"metaClass":"report$Report","id":"11227ff1-eb7b-034d-b3f6-c1830cab6c08","valuesFormats":[{"metaClass":"report$ReportValueFormat","id":"c71c6293-3ba8-f37d-fe7e-cd17afc0fde2","formatString":"dd/MM/yyyy","valueName":"orderData.order_date","report":{"metaClass":"report$Report","id":"11227ff1-eb7b-034d-b3f6-c1830cab6c08"}}],"templates":[{"metaClass":"report$ReportTemplate","id":"5ee03091-1b10-392e-86c1-2ce6d2a4f610","code":"DEFAULT","customDefinedBy":"100","custom":"false","version":"2","reportOutputType":"70","customDefinition":"","report":{"metaClass":"report$Report","id":"11227ff1-eb7b-034d-b3f6-c1830cab6c08"},"name":".chart"}],"roles":[],"defaultTemplate":{"metaClass":"report$ReportTemplate","id":"5ee03091-1b10-392e-86c1-2ce6d2a4f610"},"bands":[{"metaClass":"report$BandDefinition","id":"5a27969e-811b-79b8-861b-7d41180847f9","orientation":"1","childrenBandDefinitions":[],"name":"orderData","parentBandDefinition":{"metaClass":"report$BandDefinition","id":"08869075-903a-0440-6e85-8cc51ea2e992","orientation":"","childrenBandDefinitions":[{"metaClass":"report$BandDefinition","id":"5a27969e-811b-79b8-861b-7d41180847f9"}],"name":"Root","report":{"metaClass":"report$Report","id":"11227ff1-eb7b-034d-b3f6-c1830cab6c08"},"dataSets":[],"position":"0"},"report":{"metaClass":"report$Report","id":"11227ff1-eb7b-034d-b3f6-c1830cab6c08"},"dataSets":[{"metaClass":"report$DataSet","id":"9f70fe1d-0043-6189-5996-72404de4b7f5","entityParamName":"entity","name":"orderData","listEntitiesParamName":"entities","useExistingView":"false","bandDefinition":{"metaClass":"report$BandDefinition","id":"5a27969e-811b-79b8-861b-7d41180847f9"},"text":"select \n   o.date as order_date,\n   SUM(o.totalPrice) as total_payment\nfrom reportgeneration$Order o\nwhere o.customer.id \u005cu003d ${parameter_customer}\ngroup by o.date\norder by o.date","type":"20","view":"null"}],"position":"0"},{"metaClass":"report$BandDefinition","id":"08869075-903a-0440-6e85-8cc51ea2e992"}],"version":"40","inputParameters":[{"metaClass":"report$ReportInputParameter","id":"9a232ac1-75da-216c-9d54-c039f766553b","entityMetaClass":"reportgeneration$Customer","parameterClassName":"com.company.sample.report.entity.Customer","type":"30","required":"true","report":{"metaClass":"report$Report","id":"11227ff1-eb7b-034d-b3f6-c1830cab6c08"},"name":"Customer","alias":"parameter_customer","position":"0"}],"reportType":"10","reportScreens":[],"name":"[CHART] Income from customer by date","group":{"metaClass":"report$ReportGroup","id":"4e083530-0b9c-11e1-9b41-6bdaa41bff94","localeNames":"en\u005cu003dGeneral\nru\u005cu003d\u041e\u0431\u0449\u0438\u0435","code":"ReportGroup.default","title":"General","version":"0"}}',NULL,NULL,',reportgeneration$Customer,')
DELETE FROM REPORT_REPORT WHERE ID='70d23dab-5e8c-0450-dd8b-48983d15cefd'
INSERT INTO REPORT_REPORT VALUES('70d23dab-5e8c-0450-dd8b-48983d15cefd','2017-02-08 20:03:08.403000','admin',16,'2017-02-09 19:01:18.186000','admin','[DOCX] Invoice','INVOICE_DOC','# Accepts Order as parameter\u000a# Has Groovy and JPQL bands\u000a# Uses Persistence in Groovy\u000a# DOCX template and PDF output format',NULL,'4e083530-0b9c-11e1-9b41-6bdaa41bff94',10,'c9c6909a-b0d2-2cbe-7feb-356ee2ec697d','{"metaClass":"report$Report","id":"70d23dab-5e8c-0450-dd8b-48983d15cefd","code":"INVOICE_DOC","valuesFormats":[],"templates":[{"metaClass":"report$ReportTemplate","id":"c9c6909a-b0d2-2cbe-7feb-356ee2ec697d","code":"DEFAULT","customDefinedBy":"100","custom":"false","version":"4","reportOutputType":"40","customDefinition":"","report":{"metaClass":"report$Report","id":"70d23dab-5e8c-0450-dd8b-48983d15cefd"},"name":"invoice-template.docx"}],"roles":[],"defaultTemplate":{"metaClass":"report$ReportTemplate","id":"c9c6909a-b0d2-2cbe-7feb-356ee2ec697d"},"description":"# Accepts Order as parameter\n# Has Groovy and JPQL bands\n# Uses Persistence in Groovy\n# DOCX template and PDF output format","bands":[{"metaClass":"report$BandDefinition","id":"81f1c0c0-cb8b-a99e-6f63-ecd6f4749ac0","orientation":"","childrenBandDefinitions":[{"metaClass":"report$BandDefinition","id":"b1375a27-234b-3230-c1bd-8777f731f1d0","orientation":"0","childrenBandDefinitions":[],"name":"header","parentBandDefinition":{"metaClass":"report$BandDefinition","id":"81f1c0c0-cb8b-a99e-6f63-ecd6f4749ac0"},"report":{"metaClass":"report$Report","id":"70d23dab-5e8c-0450-dd8b-48983d15cefd"},"dataSets":[{"metaClass":"report$DataSet","id":"b87962c7-cf7a-98f6-a954-045550e0470b","entityParamName":"entity","name":"header","listEntitiesParamName":"entities","useExistingView":"false","bandDefinition":{"metaClass":"report$BandDefinition","id":"b1375a27-234b-3230-c1bd-8777f731f1d0"},"text":"def order\n\ndef tx \u005cu003d persistence.createTransaction()\ntry {\n    def em \u005cu003d persistence.getEntityManager()\n    order \u005cu003d persistence.getEntityManager().reload(params[\u005cu0027parameter_order\u005cu0027], \"order-full-view\")\n} finally {\n    tx.end()\n}\n\n[[\"company_name\":order.customer.name,\n\"billing_address\":order.customer.billingAddress,\n\"order_number\":order.number,\n\"order_date\":order.date,\n\"amount\":order.totalPrice]]\n","type":"30","view":"null"}],"position":"0"},{"metaClass":"report$BandDefinition","id":"d739a207-a0d8-e2b5-2ad4-afb9f537fcfb","orientation":"0","childrenBandDefinitions":[],"name":"details","parentBandDefinition":{"metaClass":"report$BandDefinition","id":"81f1c0c0-cb8b-a99e-6f63-ecd6f4749ac0"},"report":{"metaClass":"report$Report","id":"70d23dab-5e8c-0450-dd8b-48983d15cefd"},"dataSets":[{"metaClass":"report$DataSet","id":"8e0aa05f-63f2-39b5-e5e9-67f45cc82596","entityParamName":"entity","name":"details","listEntitiesParamName":"entities","useExistingView":"false","bandDefinition":{"metaClass":"report$BandDefinition","id":"d739a207-a0d8-e2b5-2ad4-afb9f537fcfb"},"text":"select \n   e.product as product,\n   e.quantity as quantity,\n   e.product.price as price,\n   e.subTotal as subtotal\nfrom reportgeneration$OrderItem e\nwhere e.order.id \u005cu003d ${parameter_order}\norder by e.product.name","type":"20","view":"null"}],"position":"1"}],"name":"Root","report":{"metaClass":"report$Report","id":"70d23dab-5e8c-0450-dd8b-48983d15cefd"},"dataSets":[],"position":"0"},{"metaClass":"report$BandDefinition","id":"b1375a27-234b-3230-c1bd-8777f731f1d0"},{"metaClass":"report$BandDefinition","id":"d739a207-a0d8-e2b5-2ad4-afb9f537fcfb"}],"version":"14","inputParameters":[{"metaClass":"report$ReportInputParameter","id":"eb8b5244-d14b-ee16-5f21-55a8eb8cb92b","entityMetaClass":"reportgeneration$Order","screen":"reportgeneration$Order.browse","parameterClassName":"com.company.sample.report.entity.Order","type":"30","required":"true","report":{"metaClass":"report$Report","id":"70d23dab-5e8c-0450-dd8b-48983d15cefd"},"name":"Order","alias":"parameter_order","position":"0"}],"reportType":"10","reportScreens":[],"name":"[DOCX] Invoice","group":{"metaClass":"report$ReportGroup","id":"4e083530-0b9c-11e1-9b41-6bdaa41bff94","localeNames":"en\u005cu003dGeneral\nru\u005cu003d\u041e\u0431\u0449\u0438\u0435","code":"ReportGroup.default","title":"General","version":"0"}}',NULL,NULL,',reportgeneration$Order,')
DELETE FROM REPORT_REPORT WHERE ID='badc9367-7723-7a10-37d5-aab9912fb09c'
INSERT INTO REPORT_REPORT VALUES('badc9367-7723-7a10-37d5-aab9912fb09c','2017-02-09 17:02:56.094000','admin',14,'2017-02-09 22:48:42.219000','admin','[XLSX] Single customer orders',NULL,'# Accepts Customer as report parameter\u000a# Contains vertical band\u000a# Has JPQL band with COUNT aggregator\u000a# Has Groovy band\u000a# Uses Date formatter',NULL,'4e083530-0b9c-11e1-9b41-6bdaa41bff94',10,'71d36c0a-3d54-86d6-b4e9-e700b684b60a','{"metaClass":"report$Report","id":"badc9367-7723-7a10-37d5-aab9912fb09c","valuesFormats":[{"metaClass":"report$ReportValueFormat","id":"c71c6293-3ba8-f37d-fe7e-cd17afc0fde2","formatString":"dd/MM/yyyy","valueName":"orderData.order_date","report":{"metaClass":"report$Report","id":"badc9367-7723-7a10-37d5-aab9912fb09c"}}],"templates":[{"metaClass":"report$ReportTemplate","id":"71d36c0a-3d54-86d6-b4e9-e700b684b60a","code":"DEFAULT","customDefinedBy":"100","custom":"false","version":"4","reportOutputType":"50","customDefinition":"","report":{"metaClass":"report$Report","id":"badc9367-7723-7a10-37d5-aab9912fb09c"},"name":"single-customer-orders-template.xlsx"}],"roles":[],"defaultTemplate":{"metaClass":"report$ReportTemplate","id":"71d36c0a-3d54-86d6-b4e9-e700b684b60a"},"description":"# Accepts Customer as report parameter\n# Contains vertical band\n# Has JPQL band with COUNT aggregator\n# Has Groovy band\n# Uses Date formatter","bands":[{"metaClass":"report$BandDefinition","id":"5a27969e-811b-79b8-861b-7d41180847f9","orientation":"1","childrenBandDefinitions":[],"name":"orderData","parentBandDefinition":{"metaClass":"report$BandDefinition","id":"08869075-903a-0440-6e85-8cc51ea2e992","orientation":"","childrenBandDefinitions":[{"metaClass":"report$BandDefinition","id":"9a4e629e-6f7f-34b3-aec4-a89c6ec045cf","orientation":"0","childrenBandDefinitions":[],"name":"header","parentBandDefinition":{"metaClass":"report$BandDefinition","id":"08869075-903a-0440-6e85-8cc51ea2e992"},"report":{"metaClass":"report$Report","id":"badc9367-7723-7a10-37d5-aab9912fb09c"},"dataSets":[{"metaClass":"report$DataSet","id":"de7f8445-fd99-fba2-acdb-65d92f5bd188","entityParamName":"entity","name":"header","listEntitiesParamName":"entities","useExistingView":"false","bandDefinition":{"metaClass":"report$BandDefinition","id":"9a4e629e-6f7f-34b3-aec4-a89c6ec045cf"},"text":"def customer \u005cu003d params[\"parameter_customer\"]\n\nreturn [[\"customer_name\":customer.name, \n    \"billing_address\":customer.billingAddress]]","type":"30","view":"null"}],"position":"0"},{"metaClass":"report$BandDefinition","id":"6564b281-b1a0-1d87-e98d-5bbdf0d97045","orientation":"0","childrenBandDefinitions":[],"name":"tableHeader","parentBandDefinition":{"metaClass":"report$BandDefinition","id":"08869075-903a-0440-6e85-8cc51ea2e992"},"report":{"metaClass":"report$Report","id":"badc9367-7723-7a10-37d5-aab9912fb09c"},"dataSets":[],"position":"1"},{"metaClass":"report$BandDefinition","id":"5a27969e-811b-79b8-861b-7d41180847f9"}],"name":"Root","report":{"metaClass":"report$Report","id":"badc9367-7723-7a10-37d5-aab9912fb09c"},"dataSets":[],"position":"0"},"report":{"metaClass":"report$Report","id":"badc9367-7723-7a10-37d5-aab9912fb09c"},"dataSets":[{"metaClass":"report$DataSet","id":"9f70fe1d-0043-6189-5996-72404de4b7f5","entityParamName":"entity","name":"orderData","listEntitiesParamName":"entities","useExistingView":"false","bandDefinition":{"metaClass":"report$BandDefinition","id":"5a27969e-811b-79b8-861b-7d41180847f9"},"text":"select \n   o.number as order_number,\n   o.date as order_date,\n   COUNT(DISTINCT i.product.name) as product_count,\n   o.totalPrice as total_price\nfrom reportgeneration$Order o\njoin o.items i\nwhere o.customer.id \u005cu003d ${parameter_customer}\ngroup by o.number, o.date, o.totalPrice","type":"20","view":"null"}],"position":"2"},{"metaClass":"report$BandDefinition","id":"08869075-903a-0440-6e85-8cc51ea2e992"},{"metaClass":"report$BandDefinition","id":"9a4e629e-6f7f-34b3-aec4-a89c6ec045cf"},{"metaClass":"report$BandDefinition","id":"6564b281-b1a0-1d87-e98d-5bbdf0d97045"}],"version":"12","inputParameters":[{"metaClass":"report$ReportInputParameter","id":"08b93838-a9d4-4876-26c5-706a84c02cb5","entityMetaClass":"reportgeneration$Customer","screen":"reportgeneration$Customer.browse","parameterClassName":"com.company.sample.report.entity.Customer","type":"30","required":"true","report":{"metaClass":"report$Report","id":"badc9367-7723-7a10-37d5-aab9912fb09c"},"name":"Customer","alias":"parameter_customer","position":"0"}],"reportType":"10","reportScreens":[],"name":"[XLSX] Single customer orders","group":{"metaClass":"report$ReportGroup","id":"4e083530-0b9c-11e1-9b41-6bdaa41bff94","localeNames":"en\u005cu003dGeneral\nru\u005cu003d\u041e\u0431\u0449\u0438\u0435","code":"ReportGroup.default","title":"General","version":"0"}}',NULL,NULL,',reportgeneration$Customer,')
DELETE FROM REPORT_REPORT WHERE ID='f89bbc0c-b3a8-73ce-e55a-97dc1c48f59b'
INSERT INTO REPORT_REPORT VALUES('f89bbc0c-b3a8-73ce-e55a-97dc1c48f59b','2017-02-08 20:48:01.351000','admin',80,'2017-02-19 18:16:26.835000','admin','[DOCX2PDF] Invoice','INVOICE_PDF','# Accepts Order as parameter\u000a# Has Groovy and JPQL bands\u000a# DOCX template and PDF output format\u000a# Uses output name pattern to name the generated document\u000a# Inserts a logo from the Customer entity into the report',NULL,'4e083530-0b9c-11e1-9b41-6bdaa41bff94',10,'b1d0b043-27a2-1b21-87bb-8fe72139d6e7','{"metaClass":"report$Report","id":"f89bbc0c-b3a8-73ce-e55a-97dc1c48f59b","code":"INVOICE_PDF","valuesFormats":[{"metaClass":"report$ReportValueFormat","id":"948d05af-3fd9-333d-de03-c931610650ab","formatString":"${bitmap:200x100}","valueName":"header.logo","report":{"metaClass":"report$Report","id":"f89bbc0c-b3a8-73ce-e55a-97dc1c48f59b"}},{"metaClass":"report$ReportValueFormat","id":"a38760ae-2fac-db10-3958-a0bcbdde72ed","formatString":"dd/MM/yyyy","valueName":"header.order_date","report":{"metaClass":"report$Report","id":"f89bbc0c-b3a8-73ce-e55a-97dc1c48f59b"}}],"templates":[{"metaClass":"report$ReportTemplate","id":"b1d0b043-27a2-1b21-87bb-8fe72139d6e7","code":"DEFAULT","customDefinedBy":"100","custom":"false","version":"5","outputNamePattern":"${header.file_name}.pdf","reportOutputType":"20","customDefinition":"","report":{"metaClass":"report$Report","id":"f89bbc0c-b3a8-73ce-e55a-97dc1c48f59b"},"name":"invoice-template-pdf.docx"}],"roles":[],"defaultTemplate":{"metaClass":"report$ReportTemplate","id":"b1d0b043-27a2-1b21-87bb-8fe72139d6e7"},"description":"# Accepts Order as parameter\n# Has Groovy and JPQL bands\n# DOCX template and PDF output format\n# Uses output name pattern to name the generated document\n# Inserts a logo from the Customer entity into the report","bands":[{"metaClass":"report$BandDefinition","id":"81f1c0c0-cb8b-a99e-6f63-ecd6f4749ac0","orientation":"","childrenBandDefinitions":[{"metaClass":"report$BandDefinition","id":"b1375a27-234b-3230-c1bd-8777f731f1d0","orientation":"0","childrenBandDefinitions":[],"name":"header","parentBandDefinition":{"metaClass":"report$BandDefinition","id":"81f1c0c0-cb8b-a99e-6f63-ecd6f4749ac0"},"report":{"metaClass":"report$Report","id":"f89bbc0c-b3a8-73ce-e55a-97dc1c48f59b"},"dataSets":[{"metaClass":"report$DataSet","id":"b87962c7-cf7a-98f6-a954-045550e0470b","entityParamName":"entity","name":"header","listEntitiesParamName":"entities","useExistingView":"false","bandDefinition":{"metaClass":"report$BandDefinition","id":"b1375a27-234b-3230-c1bd-8777f731f1d0"},"text":"import com.haulmont.cuba.core.app.FileStorageAPI\nimport com.haulmont.cuba.core.global.AppBeans;\n\ndef order\n\n//reload order with the right view to contain all required data\ndef tx \u005cu003d persistence.createTransaction()\ntry {\n    def em \u005cu003d persistence.getEntityManager()\n    order \u005cu003d persistence.getEntityManager().reload(params[\u005cu0027parameter_order\u005cu0027], \"order-full-view\")\n} finally {\n    tx.end()\n}\n\n//define name of the output file\ndef fileName \u005cu003d \"invoice-order-\" + order.number\n\n//define logo to insert into the report\ndef logo\n\nif (order.customer.logo \u005cu003d\u005cu003d null) \n    logo \u005cu003d null\nelse {\n    FileStorageAPI fsApi \u005cu003d AppBeans.get(FileStorageAPI.class);\n    logo \u005cu003d fsApi.loadFile(order.customer.logo)\n}\n\n//resulting map\n[[\"company_name\":order.customer.name,\n\"billing_address\":order.customer.billingAddress,\n\"order_number\":order.number,\n\"order_date\":order.date,\n\"amount\":order.totalPrice,\n\"file_name\":fileName,\n\"logo\":logo]]\n","type":"30","view":"null"}],"position":"0"},{"metaClass":"report$BandDefinition","id":"d739a207-a0d8-e2b5-2ad4-afb9f537fcfb","orientation":"0","childrenBandDefinitions":[],"name":"details","parentBandDefinition":{"metaClass":"report$BandDefinition","id":"81f1c0c0-cb8b-a99e-6f63-ecd6f4749ac0"},"report":{"metaClass":"report$Report","id":"f89bbc0c-b3a8-73ce-e55a-97dc1c48f59b"},"dataSets":[{"metaClass":"report$DataSet","id":"8e0aa05f-63f2-39b5-e5e9-67f45cc82596","entityParamName":"entity","name":"details","listEntitiesParamName":"entities","useExistingView":"false","bandDefinition":{"metaClass":"report$BandDefinition","id":"d739a207-a0d8-e2b5-2ad4-afb9f537fcfb"},"text":"select \n   e.product as product,\n   e.quantity as quantity,\n   e.product.price as price,\n   e.subTotal as subtotal\nfrom reportgeneration$OrderItem e\nwhere e.order.id \u005cu003d ${parameter_order}\norder by e.product.name","type":"20","view":"null"}],"position":"1"}],"name":"Root","report":{"metaClass":"report$Report","id":"f89bbc0c-b3a8-73ce-e55a-97dc1c48f59b"},"dataSets":[],"position":"0"},{"metaClass":"report$BandDefinition","id":"b1375a27-234b-3230-c1bd-8777f731f1d0"},{"metaClass":"report$BandDefinition","id":"d739a207-a0d8-e2b5-2ad4-afb9f537fcfb"}],"version":"78","inputParameters":[{"metaClass":"report$ReportInputParameter","id":"eb8b5244-d14b-ee16-5f21-55a8eb8cb92b","entityMetaClass":"reportgeneration$Order","screen":"reportgeneration$Order.browse","parameterClassName":"com.company.sample.report.entity.Order","type":"30","required":"true","report":{"metaClass":"report$Report","id":"f89bbc0c-b3a8-73ce-e55a-97dc1c48f59b"},"name":"Order","alias":"parameter_order","position":"0"}],"reportType":"10","reportScreens":[{"metaClass":"report$ReportScreen","id":"4b43e7a0-3f81-0a1a-eeae-98a1e80f1aae","screenId":"reportgeneration$Order.browse","report":{"metaClass":"report$Report","id":"f89bbc0c-b3a8-73ce-e55a-97dc1c48f59b"}}],"name":"[DOCX2PDF] Invoice","group":{"metaClass":"report$ReportGroup","id":"4e083530-0b9c-11e1-9b41-6bdaa41bff94","localeNames":"en\u005cu003dGeneral\nru\u005cu003d\u041e\u0431\u0449\u0438\u0435","code":"ReportGroup.default","title":"General","version":"0"}}',NULL,',reportgeneration$Order.browse,',NULL)
DELETE FROM REPORT_REPORT WHERE ID='f89bbc0c-b3a8-73ce-e55a-97dc1c48f59b'
INSERT INTO REPORT_REPORT VALUES('f89bbc0c-b3a8-73ce-e55a-97dc1c48f59b','2017-02-08 20:48:01.351000','admin',80,'2017-02-19 18:16:26.835000','admin','[DOCX2PDF] Invoice','INVOICE_PDF','# Accepts Order as parameter\u000a# Has Groovy and JPQL bands\u000a# DOCX template and PDF output format\u000a# Uses output name pattern to name the generated document\u000a# Inserts a logo from the Customer entity into the report',NULL,'4e083530-0b9c-11e1-9b41-6bdaa41bff94',10,'b1d0b043-27a2-1b21-87bb-8fe72139d6e7','{"metaClass":"report$Report","id":"f89bbc0c-b3a8-73ce-e55a-97dc1c48f59b","code":"INVOICE_PDF","valuesFormats":[{"metaClass":"report$ReportValueFormat","id":"948d05af-3fd9-333d-de03-c931610650ab","formatString":"${bitmap:200x100}","valueName":"header.logo","report":{"metaClass":"report$Report","id":"f89bbc0c-b3a8-73ce-e55a-97dc1c48f59b"}},{"metaClass":"report$ReportValueFormat","id":"a38760ae-2fac-db10-3958-a0bcbdde72ed","formatString":"dd/MM/yyyy","valueName":"header.order_date","report":{"metaClass":"report$Report","id":"f89bbc0c-b3a8-73ce-e55a-97dc1c48f59b"}}],"templates":[{"metaClass":"report$ReportTemplate","id":"b1d0b043-27a2-1b21-87bb-8fe72139d6e7","code":"DEFAULT","customDefinedBy":"100","custom":"false","version":"5","outputNamePattern":"${header.file_name}.pdf","reportOutputType":"20","customDefinition":"","report":{"metaClass":"report$Report","id":"f89bbc0c-b3a8-73ce-e55a-97dc1c48f59b"},"name":"invoice-template-pdf.docx"}],"roles":[],"defaultTemplate":{"metaClass":"report$ReportTemplate","id":"b1d0b043-27a2-1b21-87bb-8fe72139d6e7"},"description":"# Accepts Order as parameter\n# Has Groovy and JPQL bands\n# DOCX template and PDF output format\n# Uses output name pattern to name the generated document\n# Inserts a logo from the Customer entity into the report","bands":[{"metaClass":"report$BandDefinition","id":"81f1c0c0-cb8b-a99e-6f63-ecd6f4749ac0","orientation":"","childrenBandDefinitions":[{"metaClass":"report$BandDefinition","id":"b1375a27-234b-3230-c1bd-8777f731f1d0","orientation":"0","childrenBandDefinitions":[],"name":"header","parentBandDefinition":{"metaClass":"report$BandDefinition","id":"81f1c0c0-cb8b-a99e-6f63-ecd6f4749ac0"},"report":{"metaClass":"report$Report","id":"f89bbc0c-b3a8-73ce-e55a-97dc1c48f59b"},"dataSets":[{"metaClass":"report$DataSet","id":"b87962c7-cf7a-98f6-a954-045550e0470b","entityParamName":"entity","name":"header","listEntitiesParamName":"entities","useExistingView":"false","bandDefinition":{"metaClass":"report$BandDefinition","id":"b1375a27-234b-3230-c1bd-8777f731f1d0"},"text":"import com.haulmont.cuba.core.app.FileStorageAPI\nimport com.haulmont.cuba.core.global.AppBeans;\n\ndef order\n\n//reload order with the right view to contain all required data\ndef tx \u005cu003d persistence.createTransaction()\ntry {\n    def em \u005cu003d persistence.getEntityManager()\n    order \u005cu003d persistence.getEntityManager().reload(params[\u005cu0027parameter_order\u005cu0027], \"order-full-view\")\n} finally {\n    tx.end()\n}\n\n//define name of the output file\ndef fileName \u005cu003d \"invoice-order-\" + order.number\n\n//define logo to insert into the report\ndef logo\n\nif (order.customer.logo \u005cu003d\u005cu003d null) \n    logo \u005cu003d null\nelse {\n    FileStorageAPI fsApi \u005cu003d AppBeans.get(FileStorageAPI.class);\n    logo \u005cu003d fsApi.loadFile(order.customer.logo)\n}\n\n//resulting map\n[[\"company_name\":order.customer.name,\n\"billing_address\":order.customer.billingAddress,\n\"order_number\":order.number,\n\"order_date\":order.date,\n\"amount\":order.totalPrice,\n\"file_name\":fileName,\n\"logo\":logo]]\n","type":"30","view":"null"}],"position":"0"},{"metaClass":"report$BandDefinition","id":"d739a207-a0d8-e2b5-2ad4-afb9f537fcfb","orientation":"0","childrenBandDefinitions":[],"name":"details","parentBandDefinition":{"metaClass":"report$BandDefinition","id":"81f1c0c0-cb8b-a99e-6f63-ecd6f4749ac0"},"report":{"metaClass":"report$Report","id":"f89bbc0c-b3a8-73ce-e55a-97dc1c48f59b"},"dataSets":[{"metaClass":"report$DataSet","id":"8e0aa05f-63f2-39b5-e5e9-67f45cc82596","entityParamName":"entity","name":"details","listEntitiesParamName":"entities","useExistingView":"false","bandDefinition":{"metaClass":"report$BandDefinition","id":"d739a207-a0d8-e2b5-2ad4-afb9f537fcfb"},"text":"select \n   e.product as product,\n   e.quantity as quantity,\n   e.product.price as price,\n   e.subTotal as subtotal\nfrom reportgeneration$OrderItem e\nwhere e.order.id \u005cu003d ${parameter_order}\norder by e.product.name","type":"20","view":"null"}],"position":"1"}],"name":"Root","report":{"metaClass":"report$Report","id":"f89bbc0c-b3a8-73ce-e55a-97dc1c48f59b"},"dataSets":[],"position":"0"},{"metaClass":"report$BandDefinition","id":"b1375a27-234b-3230-c1bd-8777f731f1d0"},{"metaClass":"report$BandDefinition","id":"d739a207-a0d8-e2b5-2ad4-afb9f537fcfb"}],"version":"78","inputParameters":[{"metaClass":"report$ReportInputParameter","id":"eb8b5244-d14b-ee16-5f21-55a8eb8cb92b","entityMetaClass":"reportgeneration$Order","screen":"reportgeneration$Order.browse","parameterClassName":"com.company.sample.report.entity.Order","type":"30","required":"true","report":{"metaClass":"report$Report","id":"f89bbc0c-b3a8-73ce-e55a-97dc1c48f59b"},"name":"Order","alias":"parameter_order","position":"0"}],"reportType":"10","reportScreens":[{"metaClass":"report$ReportScreen","id":"4b43e7a0-3f81-0a1a-eeae-98a1e80f1aae","screenId":"reportgeneration$Order.browse","report":{"metaClass":"report$Report","id":"f89bbc0c-b3a8-73ce-e55a-97dc1c48f59b"}}],"name":"[DOCX2PDF] Invoice","group":{"metaClass":"report$ReportGroup","id":"4e083530-0b9c-11e1-9b41-6bdaa41bff94","localeNames":"en\u005cu003dGeneral\nru\u005cu003d\u041e\u0431\u0449\u0438\u0435","code":"ReportGroup.default","title":"General","version":"0"}}',NULL,',reportgeneration$Order.browse,',',reportgeneration$Order,')
COMMIT
DISCONNECT
/*C14*/INSERT INTO SYS_DB_CHANGELOG VALUES('20-reports/update/hsql/17/170201-migrateSecurityIndex.upgrade.groovy','2017-07-24 19:06:57.158000',0)
COMMIT
alter table REPORTGENERATION_CUSTOMER alter column BILLING_ADDRESS set not null 
INSERT INTO SYS_DB_CHANGELOG VALUES('50-sample-report-generation/update/hsql/17/170724-2-updateCustomer.sql','2017-07-24 19:06:57.163000',0)
COMMIT
DISCONNECT
/*C17*/SET SCHEMA PUBLIC
DISCONNECT
/*C18*/SET SCHEMA PUBLIC
DELETE FROM SYS_SERVER WHERE ID='9ce512b8-3e99-7f53-7e20-f3ceb84df599'
INSERT INTO SYS_SERVER VALUES('9ce512b8-3e99-7f53-7e20-f3ceb84df599','2017-02-07 22:05:12.170000',NULL,'2017-07-24 19:08:19.652000',NULL,'localhost:8080/app-core',TRUE,NULL)
COMMIT
DELETE FROM SEC_USER_SETTING WHERE ID='b6d344be-8ce1-c1ab-0622-94d6edc63ed8'
INSERT INTO SEC_USER_SETTING VALUES('b6d344be-8ce1-c1ab-0622-94d6edc63ed8',NULL,NULL,'60885987-1b61-4247-94c7-dff348347f93','W','report$Report.edit','<?xml version="1.0" encoding="UTF-8"?>\u000a\u000a<settings> \u000a  <components> \u000a    <component name="generalFrame.hSplit"> \u000a      <position value="22.071428" unit="%"/> \u000a    </component>  \u000a    <component name="generalFrame.treeBox"> \u000a      <groupBox expanded="true"/>\u000a    </component>  \u000a    <component name="generalFrame.bandDetailsBox"> \u000a      <groupBox expanded="true"/>\u000a    </component>  \u000a    <component name="generalFrame.bandEditor.split"> \u000a      <position value="34.375" unit="%"/> \u000a    </component>  \u000a    <component name="generalFrame.bandEditor.dataSets"> \u000a      <columns>\u000a        <columns id="name" visible="true"/>\u000a        <columns id="type" visible="true"/>\u000a      </columns>\u000a    </component>  \u000a    <component name="parametersFrame.inputParametersTable"> \u000a      <columns>\u000a        <columns id="locName" visible="true"/>\u000a        <columns id="alias" visible="true"/>\u000a        <columns id="type" visible="true"/>\u000a        <columns id="required" visible="true"/>\u000a        <columns id="validationOn" visible="true"/>\u000a      </columns>\u000a    </component>  \u000a    <component name="formatsFrame.valuesFormatsTable"> \u000a      <columns>\u000a        <columns id="valueName" visible="true"/>\u000a        <columns id="formatString" visible="true"/>\u000a      </columns>\u000a    </component>  \u000a    <component name="templatesFrame.templatesTable"> \u000a      <columns>\u000a        <columns id="name" visible="true"/>\u000a        <columns id="code" visible="true"/>\u000a        <columns id="reportOutputType" visible="true"/>\u000a        <columns id="customDefinition" visible="true"/>\u000a      </columns>\u000a    </component>  \u000a    <component name="securityFrame.WebSplitPanel"> \u000a      <position value="50.0" unit="%"/> \u000a    </component>  \u000a    <component name="securityFrame.addRoleGroupBox"> \u000a      <groupBox expanded="true"/>\u000a    </component>  \u000a    <component name="securityFrame.rolesTable"> \u000a      <columns>\u000a        <columns id="name" visible="true"/>\u000a      </columns>\u000a    </component>  \u000a    <component name="securityFrame.addScreenGroupBox"> \u000a      <groupBox expanded="true"/>\u000a    </component>  \u000a    <component name="securityFrame.screenTable"> \u000a      <columns>\u000a        <columns id="screenId" visible="true"/>\u000a      </columns>\u000a    </component>  \u000a    <component name="localesFrame.localeTextField"/> \u000a  </components> \u000a</settings>\u000a')
COMMIT
DELETE FROM SYS_SERVER WHERE ID='9ce512b8-3e99-7f53-7e20-f3ceb84df599'
INSERT INTO SYS_SERVER VALUES('9ce512b8-3e99-7f53-7e20-f3ceb84df599','2017-02-07 22:05:12.170000',NULL,'2017-07-24 19:09:19.650000',NULL,'localhost:8080/app-core',TRUE,NULL)
COMMIT
DELETE FROM SYS_SERVER WHERE ID='9ce512b8-3e99-7f53-7e20-f3ceb84df599'
INSERT INTO SYS_SERVER VALUES('9ce512b8-3e99-7f53-7e20-f3ceb84df599','2017-02-07 22:05:12.170000',NULL,'2017-07-24 19:10:19.651000',NULL,'localhost:8080/app-core',TRUE,NULL)
COMMIT
DELETE FROM SYS_SERVER WHERE ID='9ce512b8-3e99-7f53-7e20-f3ceb84df599'
INSERT INTO SYS_SERVER VALUES('9ce512b8-3e99-7f53-7e20-f3ceb84df599','2017-02-07 22:05:12.170000',NULL,'2017-07-24 19:11:19.651000',NULL,'localhost:8080/app-core',TRUE,NULL)
COMMIT
DELETE FROM SYS_SERVER WHERE ID='9ce512b8-3e99-7f53-7e20-f3ceb84df599'
INSERT INTO SYS_SERVER VALUES('9ce512b8-3e99-7f53-7e20-f3ceb84df599','2017-02-07 22:05:12.170000',NULL,'2017-07-24 19:12:19.653000',NULL,'localhost:8080/app-core',TRUE,NULL)
COMMIT
